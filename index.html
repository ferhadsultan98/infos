<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baku Metro Simulator</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/framer-motion@10.16.4/dist/framer-motion.umd.min.js"></script>
    
    <style>
        /* Simple Tooltip Styling */
        .tooltip {
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .has-tooltip:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-900 text-white font-sans">
    <div id="root"></div>

    <script type="text/babel">
        // Helper to use Framer Motion from CDN
        const { motion, AnimatePresence } = window.framer;

        // Data: Baku Metro Stations (Həzi Aslanov -> Dərnəgül)
        const metroStations = [
            { name: "Həzi Aslanov", year: 2002 },
            { name: "Əhmədli", year: 1989 },
            { name: "Xalqlar Dostluğu", year: 1989 },
            { name: "Neftçilər", year: 1972 },
            { name: "Qara Qarayev", year: 1972 },
            { name: "Koroğlu", year: 1972 },
            { name: "Ulduz", year: 1970 },
            { name: "Nəriman Nərimanov", year: 1967 },
            { name: "Gənclik", year: 1967 },
            { name: "28 May", year: 1967 },
            { name: "Nizami Gəncəvi", year: 1976 },
            { name: "Elmlər Akademiyası", year: 1985 },
            { name: "İnşaatçılar", year: 1985 },
            { name: "20 Yanvar", year: 1985 },
            { name: "Memar Əcəmi", year: 1985 },
            { name: "Nəsimi", year: 2008 },
            { name: "Azadlıq prospekti", year: 2009 },
            { name: "Dərnəgül", year: 2011 },
        ];

        // Main App Component
        const BakuMetroSimulator = () => {
            const [startStationIndex, setStartStationIndex] = React.useState(0);
            const [endStationIndex, setEndStationIndex] = React.useState(metroStations.length - 1);
            const [currentStationIndex, setCurrentStationIndex] = React.useState(null);
            const [isTraveling, setIsTraveling] = React.useState(false);
            const [completedStations, setCompletedStations] = React.useState(new Set());
            
            const stationRefs = React.useRef([]);
            
            const handleStartJourney = () => {
                if (startStationIndex === endStationIndex) return;
                
                // Reset previous journey state
                setCompletedStations(new Set());
                setCurrentStationIndex(startStationIndex);
                setIsTraveling(true);
            };

            const handleReset = () => {
                setIsTraveling(false);
                setCurrentStationIndex(null);
                setCompletedStations(new Set());
            };
            
            // Core simulation logic
            React.useEffect(() => {
                if (!isTraveling) return;

                const interval = setInterval(() => {
                    setCurrentStationIndex(prevIndex => {
                        if (prevIndex === endStationIndex) {
                            setIsTraveling(false);
                            setCompletedStations(prev => new Set(prev).add(endStationIndex));
                            clearInterval(interval);
                            return prevIndex;
                        }

                        setCompletedStations(prev => new Set(prev).add(prevIndex));
                        
                        // Determine direction
                        const direction = startStationIndex < endStationIndex ? 1 : -1;
                        return prevIndex + direction;
                    });
                }, 1000); // 1 second per station

                return () => clearInterval(interval);
            }, [isTraveling, endStationIndex, startStationIndex]);

            // Calculate train's position dynamically
            const trainXPosition = React.useMemo(() => {
                if (currentStationIndex === null || !stationRefs.current[currentStationIndex]) {
                    return -100; // Hide train initially
                }
                // Center the train on the station dot
                const stationElement = stationRefs.current[currentStationIndex];
                return stationElement.offsetLeft + stationElement.clientWidth / 2;
            }, [currentStationIndex]);

            const travelTime = Math.abs(endStationIndex - startStationIndex);
            const currentStationName = currentStationIndex !== null ? metroStations[currentStationIndex].name : 'N/A';

            return (
                <div className="container mx-auto p-4 md:p-8">
                    <header className="text-center mb-8">
                        <h1 className="text-4xl md:text-5xl font-bold text-blue-400 mb-2">Baku Metro Simulator 🚇</h1>
                        <p className="text-gray-400">Visualize a journey through Baku's metro system.</p>
                    </header>
                    
                    {/* Controls Section */}
                    <div className="bg-gray-800 p-6 rounded-xl shadow-lg mb-10 flex flex-col md:flex-row items-center justify-center gap-4 flex-wrap">
                        <div className="w-full md:w-auto">
                            <label htmlFor="start-station" className="block text-sm font-medium text-gray-300 mb-1">Start Station</label>
                            <select 
                                id="start-station"
                                value={startStationIndex}
                                onChange={(e) => setStartStationIndex(Number(e.target.value))}
                                disabled={isTraveling}
                                className="w-full bg-gray-700 border-gray-600 rounded-md py-2 px-3 text-white focus:ring-2 focus:ring-blue-500"
                            >
                                {metroStations.map((station, index) => (
                                    <option key={index} value={index}>{station.name}</option>
                                ))}
                            </select>
                        </div>
                        
                        <div className="w-full md:w-auto">
                            <label htmlFor="end-station" className="block text-sm font-medium text-gray-300 mb-1">End Station</label>
                            <select 
                                id="end-station"
                                value={endStationIndex}
                                onChange={(e) => setEndStationIndex(Number(e.target.value))}
                                disabled={isTraveling}
                                className="w-full bg-gray-700 border-gray-600 rounded-md py-2 px-3 text-white focus:ring-2 focus:ring-blue-500"
                            >
                                {metroStations.map((station, index) => (
                                    <option key={index} value={index}>{station.name}</option>
                                ))}
                            </select>
                        </div>

                        <div className="flex space-x-3 mt-4 md:mt-0">
                            <button 
                                onClick={handleStartJourney}
                                disabled={isTraveling || startStationIndex === endStationIndex}
                                className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition-colors disabled:bg-gray-500 disabled:cursor-not-allowed"
                            >
                                {isTraveling ? 'Traveling...' : 'Start'}
                            </button>
                            <button 
                                onClick={handleReset}
                                className="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-lg transition-colors"
                            >
                                Reset
                            </button>
                        </div>
                    </div>
                    
                    {/* Status & Info Display */}
                    <AnimatePresence>
                        {(isTraveling || currentStationIndex !== null) && (
                            <motion.div
                                initial={{ opacity: 0, y: -20 }}
                                animate={{ opacity: 1, y: 0 }}
                                exit={{ opacity: 0, y: -20 }}
                                className="text-center bg-gray-800/50 backdrop-blur-sm p-4 rounded-lg mb-10"
                            >
                                <p className="text-lg">
                                    <span className="font-bold text-blue-300">Current Status:</span>
                                    {isTraveling ? ` Moving towards ${metroStations[endStationIndex].name}` : ` Arrived at ${currentStationName}`}
                                </p>
                                <p className="text-sm text-gray-400">
                                    Current Station: <span className="font-semibold">{currentStationName}</span>
                                    {travelTime > 0 && ` | Estimated Travel Time: ~${travelTime}s`}
                                </p>
                            </motion.div>
                        )}
                    </AnimatePresence>


                    {/* Metro Line Visualization */}
                    <div className="w-full overflow-x-auto pb-10">
                        <div className="relative inline-flex items-center w-max min-w-full px-8 py-10">
                           
                            {/* The metro line track */}
                            <div className="absolute top-1/2 left-0 right-0 h-1.5 bg-gray-600 -translate-y-1/2">
                                <motion.div 
                                    className="h-full bg-green-500"
                                    initial={{ width: 0 }}
                                    animate={{ 
                                        width: `${(completedStations.size / (metroStations.length-1)) * 100}%`
                                    }}
                                />
                            </div>

                            {/* Train Icon */}
                            <AnimatePresence>
                                {currentStationIndex !== null && (
                                    <motion.div
                                        className="absolute top-1/2 z-20 text-4xl"
                                        style={{ transform: 'translate(-50%, -100%)' }}
                                        initial={{ x: -100, y: '-100%' }}
                                        animate={{ x: trainXPosition, y: '-100%' }}
                                        transition={{ type: 'spring', stiffness: 50, damping: 15 }}
                                    >
                                        🚇
                                    </motion.div>
                                )}
                            </AnimatePresence>

                            {/* Stations */}
                            <div className="relative flex justify-between w-full">
                                {metroStations.map((station, index) => {
                                    const isCompleted = completedStations.has(index);
                                    const isCurrent = index === currentStationIndex;
                                    
                                    let circleColor = 'bg-gray-700 border-gray-500';
                                    if(isCompleted) circleColor = 'bg-green-500 border-green-400';
                                    if(isCurrent) circleColor = 'bg-blue-500 border-blue-300 animate-pulse';

                                    return (
                                        <div
                                            key={station.name}
                                            ref={el => stationRefs.current[index] = el}
                                            className="relative flex flex-col items-center has-tooltip"
                                            style={{
                                                flex: `1 0 ${100 / metroStations.length}%`,
                                                minWidth: '80px', // Ensure stations don't get too cramped
                                            }}
                                        >
                                            <div className={`w-6 h-6 rounded-full border-4 z-10 transition-all duration-300 ${circleColor} shadow-md`}></div>
                                            <p className="text-center text-xs mt-3 whitespace-nowrap">{station.name}</p>
                                            
                                            {/* Tooltip */}
                                            <div className="tooltip absolute bottom-full mb-2 w-max bg-gray-900/80 text-white text-xs rounded py-1 px-2 z-30 backdrop-blur-sm shadow-lg">
                                                Opened: {station.year}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Render the app
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<BakuMetroSimulator />);
    </script>
</body>
</html>
